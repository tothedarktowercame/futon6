;; Wiring Diagram Metatheory for Mathematical Discourse
;; =====================================================
;; 3 structural roles, 78 types ‚Äî empirically derived from 4,963 physics.SE entities.
;;
;; Mathematical text is a WIRING DIAGRAM:
;;
;;   COMPONENTS ‚Äî scope bindings (30 types)
;;                Form a tree via :hx/parent (nesting = containment).
;;
;;   PORTS      ‚Äî anaphoric references (11 types)
;;                Cross-tree edges. Turn the scope tree into a graph.
;;
;;   WIRES      ‚Äî connectives (5 types, with 32 reasoning labels)
;;                The argument flow between components.
;;                "Since A, therefore B" is a wire from A to B.
;;
;; Key insight: informal language IS the wiring diagram. Connectives
;; are not annotations on scope nodes ‚Äî they are the EDGES that create
;; argument structure. Remove the wires and you have isolated components
;; with no logical flow between them.
;;
;; Lexical layers (pass-through, not extracted by LLM):
;;   $MATH$  ‚Äî LaTeX expressions (preserved verbatim)
;;   üçÖ NER  ‚Äî named math concepts (19K kernel lookup)
;;
;; Every type is empirically attested. The LLM classifies into this
;; type system; it does not invent types.
;;
;; v3.0 supersedes v2.0, which treated connectives as annotations on
;; scope nodes. v3.0 recognises that connectives are the wiring itself.
;; See scope-metatheory.edn for detailed component role schemas.

{:metatheory/version "3.0"
 :metatheory/source  "physics.stackexchange (4963 entities sampled)"
 :metatheory/date    "2026-02-10"
 :metatheory/model   :wiring-diagram

 ;; ============================================================
 ;; COMPONENTS ‚Äî 30 types, tree structure via :hx/parent
 ;; ============================================================
 ;; Components are the BOXES of the wiring diagram.
 ;; Each introduces, restricts, or closes a mathematical scope.
 ;; See scope-metatheory.edn for full type definitions + role schemas.

 :component-types
 {:bind     ["bind/let" "bind/define" "bind/name" "bind/associate"]
  :quant    ["quant/universal" "quant/existential" "quant/select" "quant/given"]
  :assume   ["assume/explicit" "assume/conditional" "assume/consider" "assume/wlog"]
  :constrain ["constrain/where" "constrain/such-that" "constrain/with" "constrain/here"]
  :formula  ["formula/integral" "formula/limit" "formula/sum-index"
             "formula/prod-index" "formula/set-builder" "formula/sup-inf"
             "formula/quantifier-symbol"]
  :proof    ["proof/claim" "proof/case" "proof/induction" "proof/method"]
  :conclude ["conclude/therefore" "conclude/explicit" "conclude/qed"]}

 :component-stats
 {:total-events 5322
  :events-per-entity 1.07
  :classical-coverage 0.24}

 ;; ============================================================
 ;; PORTS ‚Äî 11 types, cross-tree references
 ;; ============================================================
 ;; Ports are the INTERFACES of components.
 ;; Each connects a component to another that is NOT its tree
 ;; ancestor/descendant. Ports turn the scope tree into a graph.
 ;;
 ;; A port has:
 ;;   :hx/source ‚Äî the component containing the referring expression
 ;;   :hx/target ‚Äî the component being referenced

 :port-types
 {:demonstrative
  [{:type "port/that-noun"     :frequency 184
    :pattern "that root / that function / that map"
    :desc "Demonstrative reference to a prior binding"}
   {:type "port/this-noun"     :frequency 472
    :pattern "this equation / this operator / this means"
    :desc "Proximal demonstrative to recent binding or result"}
   {:type "port/the-above"     :frequency 309
    :pattern "the above expression / the preceding argument"
    :desc "Spatial/textual reference to prior content"}
   {:type "port/the-same"      :frequency 1857
    :pattern "the same quantum state / the same space"
    :desc "Identity assertion ‚Äî two references share a referent"}
   {:type "port/such"          :frequency 296
    :pattern "such a function / such elements"
    :desc "Kind-reference to a prior type or condition"}
   {:type "port/latter-former" :frequency 132
    :pattern "the former / the latter"
    :desc "Positional reference in a previously introduced pair"}]

  :structural
  [{:type "port/respectively"  :frequency 124
    :pattern "X and Y are A and B, respectively"
    :desc "Parallel binding: maps a list to a prior list"}
   {:type "port/similarly"     :frequency 127
    :pattern "Similarly, ... / Analogously, ..."
    :desc "Structural analogy ‚Äî reuses prior argument shape"}
   {:type "port/likewise"      :frequency 57
    :pattern "Likewise / Correspondingly"
    :desc "Parallel structure with prior scope"}]

  :persistence
  [{:type "port/still"         :frequency 11
    :pattern "is still $X$ / still holds / still valid"
    :desc "Identity persistence across a scope boundary"}
   {:type "port/remains"       :frequency 171
    :pattern "remains true / remains valid / remains a ..."
    :desc "Asserts binding survives a scope transition"}]}

 :port-stats
 {:total-events 3932
  :events-per-entity 0.79}

 ;; ============================================================
 ;; WIRES ‚Äî 5 connective types + 32 label types
 ;; ============================================================
 ;; Wires are the EDGES of the wiring diagram.
 ;; Each connects a SOURCE component to a TARGET component,
 ;; carrying logical flow between them.
 ;;
 ;; A wire has:
 ;;   TYPE  ‚Äî one of 5 connective types (HOW it connects)
 ;;   LABEL ‚Äî one of 32 reasoning types, or nil (WHAT it transports)
 ;;
 ;; Directionality: source is the logically prior component
 ;; (premise/reason/context), target is the logically posterior
 ;; (conclusion/result/consequence). Wire type encodes the
 ;; relationship, not textual order.
 ;;
 ;; "Since A, B"      ‚Üí source: A, target: B, wire/causal
 ;; "B because A"     ‚Üí source: A, target: B, wire/causal
 ;; "A, therefore B"  ‚Üí source: A, target: B, wire/consequential
 ;; "A, but B"        ‚Üí source: A, target: B, wire/adversative

 :wire-types
 [{:type "wire/adversative"    :frequency 5953
   :pattern "but / however / on the other hand / nevertheless / yet"
   :desc "Tension or contradiction: target contrasts with source"}
  {:type "wire/causal"         :frequency 3707
   :pattern "because / since / the reason is / as / given that"
   :desc "Justification: source is the reason for target"}
  {:type "wire/consequential"  :frequency 5697
   :pattern "so / therefore / thus / hence / it follows / note that"
   :desc "Derivation: source entails target"}
  {:type "wire/clarifying"     :frequency 506
   :pattern "that is / in other words / namely / more precisely / i.e."
   :desc "Refinement: target restates or sharpens source"}
  {:type "wire/intuitive"      :frequency 49
   :pattern "intuitively / roughly speaking / heuristically"
   :desc "Register shift: target is informal version of source"}]

 ;; Wire labels say WHAT reasoning flows through the wire.
 ;; Most wires are unlabelled (pure logical flow).
 ;; Labelled wires carry a specific reasoning move.

 :wire-label-types
 {:strategy
  ["strategy/example"          ;; 703
   "strategy/analogy"          ;; 352
   "strategy/contradiction"    ;; 288
   "strategy/inversion"        ;; 261
   "strategy/generalize"       ;; 217
   "strategy/simplify"         ;; 185
   "strategy/count"            ;; 141
   "strategy/special-case"     ;; 90
   "strategy/dimensions"       ;; 57
   "strategy/symmetry"         ;; 41
   "strategy/extreme-case"]    ;; 18

  :explain
  ["explain/think-of"          ;; 880
   "explain/meaning"           ;; 367
   "explain/register-shift"    ;; 426
   "explain/the-idea"]         ;; 37

  :correct
  ["correct/actually"          ;; 731
   "correct/wrong"             ;; 153
   "correct/subtlety"          ;; 82
   "correct/misconception"     ;; 27
   "correct/careful"]          ;; 11

  :approx
  ["approx/neglect"            ;; 291
   "approx/order-of-mag"       ;; 255
   "approx/perturbative"       ;; 95
   "approx/regime"]            ;; 35

  :epistemic
  ["epistemic/can-show"        ;; 318
   "epistemic/turns-out"       ;; 148
   "epistemic/not-obvious"     ;; 133
   "epistemic/known"           ;; 25
   "epistemic/open"]           ;; 12

  :construct
  ["construct/exists"          ;; 1354
   "construct/explicit"        ;; 562
   "construct/build"]}         ;; 344

 :wire-stats
 {:total-connective-events 15912
  :connective-per-entity 3.21
  :total-label-events 8639
  :label-per-entity 1.74}

 ;; ============================================================
 ;; COMBINED
 ;; ============================================================
 :combined
 {:total-structural-types 46   ;; 30 component + 11 port + 5 wire
  :total-label-types 32
  :total-types 78

  ;; What the LLM produces per entity:
  ;; ~1.1 component records (scope bindings, forming a tree)
  ;; ~0.8 port records (cross-tree anaphoric references)
  ;; ~3.2 wire records (connective edges, ~1.7 with reasoning labels)
  ;; Total: ~5.1 records, ~7 classification decisions per entity
  }

 ;; ============================================================
 ;; REPRESENTATION
 ;; ============================================================
 ;; Three kinds of hyperedge, all futon4-compatible:
 ;;
 ;; COMPONENT (scope binding ‚Äî a box):
 ;; {:hx/id     "e849:c-002"
 ;;  :hx/role   :component
 ;;  :hx/type   "bind/let"
 ;;  :hx/parent "e849:c-001"                ;; tree nesting
 ;;  :hx/ends   [{:role "symbol" :latex "\\xi"}
 ;;              {:role "type"   :text "that root"}]
 ;;  :hx/content {:match "Let $\\xi$ be that root" :position 142}}
 ;;
 ;; PORT (anaphoric reference ‚Äî a cross-tree edge):
 ;; {:hx/id     "e849:p-000"
 ;;  :hx/role   :port
 ;;  :hx/type   "port/the-above"
 ;;  :hx/source "e849:c-003"                ;; component with the reference
 ;;  :hx/target "e849:c-000"                ;; component being referenced
 ;;  :hx/content {:match "the above expression" :position 200}}
 ;;
 ;; WIRE (connective ‚Äî an argument edge):
 ;; {:hx/id     "e849:w-000"
 ;;  :hx/role   :wire
 ;;  :hx/type   "wire/causal"
 ;;  :hx/source "e849:c-001"                ;; premise component
 ;;  :hx/target "e849:c-003"                ;; conclusion component
 ;;  :hx/label  "strategy/contradiction"    ;; reasoning label (or nil)
 ;;  :hx/content {:match "Since" :position 180}}
 ;;
 ;; The tree (:hx/parent on components) gives scope nesting.
 ;; The ports give cross-tree identity (anaphoric graph).
 ;; The wires give argument flow (reasoning graph).
 ;; Together: a typed wiring diagram encoding mathematical discourse.
 }
