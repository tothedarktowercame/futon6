flowchart TD
    %% Problem 10 â€” Claude draft (pre-Codex)

    %% Edge type legend:
    %% assert=solid thick  challenge=dashed red  reform=solid yellow
    %% clarify=solid blue  exemplify=dashed purple  reference=solid gray

    %% Nodes
    p10-problem{{"p10-problem<br/>Given the mode-k subproblem [(ZâŠ—K)áµ€SS'(ZâŠ—K) + Î»(Iáµ£âŠ—K..."}}
    p10-s1["p10-s1<br/>Why direct methods fail: The system matrix A is nrÃ—n..."]
    p10-s2["p10-s2<br/>The key insight: CG only requires the action v â†¦ Av,..."]
    p10-s2a(["p10-s2a<br/>Forward map at observed entries: By the Kronecker id..."])
    p10-s2b(["p10-s2b<br/>Adjoint map from sparse result: The sparse vector w ..."])
    p10-s2c(["p10-s2c<br/>Regularization term: Î»(Iáµ£âŠ—K)vec(V) = Î»Â·vec(KV). Cost..."])
    p10-s2-total(["p10-s2-total<br/>Total per matvec: O(nÂ²r + qr). No dependence on N. T..."])
    p10-s3["p10-s3<br/>Right-hand side: b = (Iáµ£âŠ—K)vec(B) where B = TZ. T is..."]
    p10-s4["p10-s4<br/>Preconditioner choice: P = (HâŠ—K) where H = Záµ€Z + Î»Iáµ£..."]
    p10-s4-hadamard(["p10-s4-hadamard<br/>Why this structure? The Khatri-Rao Hadamard property..."])
    p10-s4-solve(["p10-s4-solve<br/>Preconditioner solve: Pâ»Â¹ = Hâ»Â¹âŠ—Kâ»Â¹. Precompute Chol..."])
    p10-s5["p10-s5<br/>Convergence: CG on Pâ»Â¹A converges in t = O(âˆšÎºÂ·log(1/..."]
    p10-s6["p10-s6<br/>Complexity summary: Total per mode-k subproblem O(nÂ³..."]
    p10-s7["p10-s7<br/>Algorithm: SETUP computes Cholesky factors and RHS. ..."]

    %% Edges
    p10-s1 -.->|"ğŸ”´ challenge: Direct methods cost O(Nnr), proportio..."| p10-problem
    p10-s2 -->|"ğŸŸ¡ reform: CG only requires v â†¦ Av, never the ma..."| p10-s1
    p10-s2a -->|"ğŸ”µ clarify: Kronecker identity gives forward map;..."| p10-s2
    p10-s2b -->|"ğŸ”µ clarify: Sparse W' has only q nonzeros; adjoin..."| p10-s2
    p10-s2c -->|"ğŸ”µ clarify: Regularization is just Î»Â·vec(KV), O(nÂ²r)"| p10-s2
    p10-s2-total ==>|"ğŸŸ¢ assert: Combining forward + adjoint + regular..."| p10-s2a
    p10-s2-total ==>|"ğŸŸ¢ assert: Combining forward + adjoint + regular..."| p10-s2b
    p10-s2-total ==>|"ğŸŸ¢ agree: Regularization absorbed into nÂ²r term"| p10-s2c
    p10-s3 -->|"ğŸ”µ clarify: RHS uses sparse T and Kronecker struc..."| p10-problem
    p10-s4 -->|"ğŸŸ¡ reform: P = (HâŠ—K) approximates A for faster c..."| p10-s2
    p10-s4-hadamard -->|"ğŸ”µ clarify: Khatri-Rao Hadamard: Záµ€Z = âˆ(Aáµ¢áµ€Aáµ¢), ..."| p10-s4
    p10-s4-solve -.->|"ğŸŸ£ exemplify: Pâ»Â¹ = Hâ»Â¹âŠ—Kâ»Â¹ via Cholesky; each solv..."| p10-s4
    p10-s5 ==>|"ğŸŸ¢ assert: P â‰ˆ A âŸ¹ Îº(Pâ»Â¹A) small âŸ¹ t = O(r) iter..."| p10-s4
    p10-s6 ==>|"ğŸŸ¢ assert: O(nÂ³ + t(nÂ²r + qr)), no N-dependence,..."| p10-problem
    p10-s6 -->|"âšª reference: Matvec cost O(nÂ²r + qr) per iteration"| p10-s2-total
    p10-s6 -->|"âšª reference: Preconditioner solve O(nÂ²r) per itera..."| p10-s4-solve
    p10-s6 -->|"âšª reference: t = O(r) iterations from convergence ..."| p10-s5
    p10-s7 -.->|"ğŸŸ£ exemplify: Pseudocode instantiates the complexit..."| p10-s6
    p10-s7 -->|"âšª reference: MATVEC subroutine implements implicit..."| p10-s2
    p10-s7 -->|"âšª reference: PRECOND_SOLVE subroutine implements K..."| p10-s4-solve

    %% Styling
    classDef question fill:#f9e,stroke:#c06,stroke-width:3px
    class p10-problem question
    classDef answer fill:#cef,stroke:#38b,stroke-width:2px
    class p10-s1,p10-s2,p10-s3,p10-s4,p10-s5,p10-s6,p10-s7 answer
    classDef comment fill:#eee,stroke:#999,stroke-width:1px
    class p10-s2a,p10-s2b,p10-s2c,p10-s2-total,p10-s4-hadamard,p10-s4-solve comment