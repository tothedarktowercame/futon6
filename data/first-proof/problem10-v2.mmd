flowchart TD
    %% Problem 10 â€” after Codex polish

    %% Edge type legend:
    %% assert=solid thick  challenge=dashed red  reform=solid yellow
    %% clarify=solid blue  exemplify=dashed purple  reference=solid gray

    %% Nodes
    p10-problem{{"p10-problem<br/>Given [(ZâŠ—K_tau)áµ€SS'(ZâŠ—K_tau) + Î»(Iáµ£âŠ—K_tau)]vec(W) =..."}}
    p10-s1["p10-s1<br/>Why naive direct methods fail: A is nrÃ—nr, so dense ..."]
    p10-s2["p10-s2<br/>Key insight: with Î»>0 and K_tau â‰» 0, PCG only needs ..."]
    p10-s2a(["p10-s2a<br/>Forward map at observed entries: By the Kronecker id..."])
    p10-s2b(["p10-s2b<br/>Adjoint map from sparse result: The sparse vector w ..."])
    p10-s2c(["p10-s2c<br/>Regularization term: Î»(Iáµ£âŠ—K_tau)vec(V) = Î»Â·vec(K_tau..."])
    p10-s2-total(["p10-s2-total<br/>Total per matvec: O(nÂ²r + qr). No dependence on N. T..."])
    p10-s3["p10-s3<br/>Right-hand side: b = (Iáµ£âŠ—K_tau)vec(B) where B = TZ. ..."]
    p10-s4["p10-s4<br/>Preconditioner choice: after whitening by K_tau^{-1/..."]
    p10-s4-hadamard(["p10-s4-hadamard<br/>Why this structure? The Khatri-Rao Hadamard property..."])
    p10-s4-solve(["p10-s4-solve<br/>Preconditioner solve: Pâ»Â¹ = Hâ»Â¹âŠ—K_tauâ»Â¹. Precompute ..."])
    p10-s5["p10-s5<br/>Convergence: PCG has t = O(âˆšÎº log(1/Îµ)) with Îº = con..."]
    p10-s6["p10-s6<br/>Complexity summary: total per mode-k subproblem is O..."]
    p10-s7["p10-s7<br/>Algorithm: SETUP builds K_tau, H, and RHS; PCG then ..."]

    %% Edges
    p10-s1 -.->|"ğŸ”´ challenge: Naive explicit direct methods incur O..."| p10-problem
    p10-s2 -->|"ğŸŸ¡ reform: CG only requires v â†¦ Av, never the ma..."| p10-s1
    p10-s2a -->|"ğŸ”µ clarify: Kronecker identity gives forward map;..."| p10-s2
    p10-s2b -->|"ğŸ”µ clarify: Sparse W' has s<=q nonzeros; adjoint ..."| p10-s2
    p10-s2c -->|"ğŸ”µ clarify: Regularization is just Î»Â·vec(KV), O(nÂ²r)"| p10-s2
    p10-s2-total ==>|"ğŸŸ¢ assert: Combining forward + adjoint + regular..."| p10-s2a
    p10-s2-total ==>|"ğŸŸ¢ assert: Combining forward + adjoint + regular..."| p10-s2b
    p10-s2-total ==>|"ğŸŸ¢ agree: Regularization absorbed into nÂ²r term"| p10-s2c
    p10-s3 -->|"ğŸ”µ clarify: RHS uses sparse T and Kronecker struc..."| p10-problem
    p10-s4 -->|"ğŸŸ¡ reform: Whitened surrogate motivates P = (HâŠ—K..."| p10-s2
    p10-s4-hadamard -->|"ğŸ”µ clarify: Khatri-Rao Hadamard: Záµ€Z = âˆ(Aáµ¢áµ€Aáµ¢), ..."| p10-s4
    p10-s4-solve -.->|"ğŸŸ£ exemplify: Pâ»Â¹ = Hâ»Â¹âŠ—K_tauâ»Â¹ via Cholesky; solve..."| p10-s4
    p10-s5 ==>|"ğŸŸ¢ assert: Spectral equivalence bounds Îº(Pâ»Â¹A), ..."| p10-s4
    p10-s6 ==>|"ğŸŸ¢ assert: O(nÂ³ + rÂ³ + t(nÂ²r + qr + nrÂ²)); no ex..."| p10-problem
    p10-s6 -->|"âšª reference: Matvec cost O(nÂ²r + qr) per iteration"| p10-s2-total
    p10-s6 -->|"âšª reference: Preconditioner solve O(nÂ²r + nrÂ²) per..."| p10-s4-solve
    p10-s6 -->|"âšª reference: Iteration count from standard PCG bou..."| p10-s5
    p10-s7 -.->|"ğŸŸ£ exemplify: Pseudocode instantiates the complexit..."| p10-s6
    p10-s7 -->|"âšª reference: MATVEC subroutine implements implicit..."| p10-s2
    p10-s7 -->|"âšª reference: PRECOND_SOLVE subroutine implements K..."| p10-s4-solve

    %% Styling
    classDef question fill:#f9e,stroke:#c06,stroke-width:3px
    class p10-problem question
    classDef answer fill:#cef,stroke:#38b,stroke-width:2px
    class p10-s1,p10-s2,p10-s3,p10-s4,p10-s5,p10-s6,p10-s7 answer
    classDef comment fill:#eee,stroke:#999,stroke-width:1px
    class p10-s2a,p10-s2b,p10-s2c,p10-s2-total,p10-s4-hadamard,p10-s4-solve comment